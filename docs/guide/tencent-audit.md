# 腾讯云审核配置

本页面详细介绍如何配置腾讯云数据万象进行图片审核。

## 概述

腾讯云数据万象（CI）提供专业的内容审核服务：
- 采用前沿识别算法
- 海量违规数据训练
- 多场景识别（色情、违法、广告等）
- 实时更新识别标准

## 价格说明

### 免费额度

- **次数**：10万次
- **有效期**：2个月
- **适用**：图片审核、视频审核、音频审核等

### 付费额度

- **新用户优惠**：可低价购买10万次额度
- **有效期**：1年
- **购买地址**：[数据万象专场特惠](https://cloud.tencent.com/act/pro/ci)

### 计费方式

超出免费额度后按次数计费，具体价格请查看腾讯云官网。

## 配置步骤

### 前置要求

- 腾讯云账号（已实名认证）
- 开通数据万象服务
- 有可用余额或免费额度

### 步骤 1：获取 Bucket

1. 登录 [数据万象控制台](https://console.cloud.tencent.com/ci)
2. 点击「概览」
3. 点击「立即开通服务」
4. 点击「授权」
5. 点击「同意授权」
6. 点击「绑定存储桶」
7. 点击「新建」
8. 输入存储桶名称（如 `my-audit-bucket`）
9. 选择所属地域
10. 点击「确定」

::: warning 重要
内容审核仅支持以下地域：
- 北京、上海、广州、成都、重庆、南京
- 中国香港、新加坡、孟买、法兰克福
:::

**获取 Bucket 值：**

存储桶创建后，Bucket 名称会自动添加一串数字后缀，例如：
```
输入名称：my-audit-bucket
实际名称：my-audit-bucket-1234567890
```

完整的 Bucket 名称就是配置中需要的值。

### 步骤 2：获取 Region

Region 是存储桶所在的地域代码：

| 所属地域 | Region 代码 |
|---------|------------|
| 华北（北京） | `ap-beijing` |
| 华东（上海） | `ap-shanghai` |
| 华南（广州） | `ap-guangzhou` |
| 西南（成都） | `ap-chengdu` |
| 西南（重庆） | `ap-chongqing` |
| 华东（南京） | `ap-nanjing` |
| 香港 | `ap-hongkong` |
| 新加坡 | `ap-singapore` |
| 孟买 | `ap-mumbai` |
| 法兰克福 | `eu-frankfurt` |

选择你在步骤 1 中选择的地域对应的代码。

### 步骤 3：获取 BizType

1. 在数据万象控制台找到刚才创建的存储桶
2. 点击「管理」
3. 点击「内容审核」
4. 点击「审核策略」
5. 找到「默认策略」或创建自定义策略
6. 复制 BizType 值（一串数字和字母）

示例：`912f9a305ae1101b9f7430435ec51f66`

### 步骤 4：获取 SecretId 和 SecretKey

1. 登录 [访问管理控制台](https://console.cloud.tencent.com/cam/capi)
2. 点击「云 API 密钥」
3. 点击「新建密钥」
4. **立即保存 SecretId 和 SecretKey**（SecretKey 只显示一次！）
5. 点击「确定」

::: danger 重要提示
SecretKey 只会展示一次，关闭后无法再次查看。请务必保存好！
:::

## 插件配置

### 完整配置示例

```yaml
imageReviewEnabled: true
imageReviewFailAction: block
muteOnReviewFailed: false
muteTime: 60000
enabledGroups: []

imageAudit:
  engine: tencent
  secretId: "AKIDxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
  secretKey: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
  region: "ap-chengdu"
  bucket: "my-audit-bucket-1234567890"
  bizType: "912f9a305ae1101b9f7430435ec51f66"
```

### 配置说明

| 配置项 | 说明 | 示例值 |
|--------|------|--------|
| `secretId` | 腾讯云密钥ID | `AKIDxxx...` |
| `secretKey` | 腾讯云密钥Key | `xxx...` |
| `region` | 存储桶地域 | `ap-chengdu` |
| `bucket` | 存储桶完整名称 | `bucket-1234567890` |
| `bizType` | 审核策略类型 | `912f9a...` |

## 审核策略

### 自定义策略（可选）

在腾讯云控制台可以自定义审核策略：

1. 进入存储桶管理
2. 内容审核 → 审核策略
3. 点击「新增策略」
4. 配置审核场景和敏感度
5. 保存后获取新的 BizType

**可配置场景：**
- 色情识别
- 违法违规
- 广告识别
- 暴力恐怖
- 等等...

**敏感度设置：**
- 宽松
- 标准（推荐）
- 严格

## 测试和调试

### 启用调试日志

```yaml
debugLog: true
```

查看详细审核信息：
```
[图片审核] 开始图片审核...
[图片审核] 审核通过: 正常内容, 分数: 0.12
```

### 测试审核功能

1. 生成一张测试图片
2. 查看日志输出
3. 确认审核结果正确

### 常见问题排查

**审核总是失败？**

检查清单：
- [ ] SecretId 和 SecretKey 是否正确
- [ ] Bucket 名称是否完整（包含后缀数字）
- [ ] Region 是否与存储桶匹配
- [ ] BizType 是否正确
- [ ] 账号是否有余额
- [ ] 是否在支持的地域

**审核太慢？**

优化建议：
- 选择就近的地域
- 检查网络连接
- 考虑使用 API4AI

**成本太高？**

控制建议：
- 仅在必要群组启用
- 监控每月使用量
- 在免费额度内合理分配

## 安全建议

### 1. 密钥安全

- ✅ 不要将密钥提交到公开仓库
- ✅ 定期更换密钥
- ✅ 使用环境变量存储
- ✅ 限制密钥权限范围

### 2. 审核策略

- ✅ 根据社区性质选择合适的敏感度
- ✅ 定期检查审核效果
- ✅ 收集用户反馈调整策略

### 3. 成本控制

- ✅ 设置费用告警
- ✅ 监控使用量
- ✅ 避免滥用

## 监控和统计

### 查看使用量

在腾讯云控制台可以查看：
- 每日审核次数
- 审核通过率
- 费用统计

### 日志分析

启用调试日志后，可以统计：
- 审核通过的图片数量
- 审核失败的图片数量
- 常见失败原因

## API4AI 配置（备选）

如果不想使用腾讯云，可以选择 API4AI：

```yaml
imageAudit:
  engine: api4ai
  api4ai:
    nsfwThreshold: 0.7
```

### 优势

- 配置超简单
- 无需存储桶
- 快速部署

### 劣势

- 功能相对简单
- 仅识别 NSFW
- 可能不支持中文

## 常见问题

### Q: 免费额度用完怎么办？

- 购买付费额度
- 切换到 API4AI
- 关闭审核功能
- 仅在重要群组启用

### Q: 如何查看剩余额度？

在腾讯云控制台的「数据万象」→「用量统计」中查看。

### Q: 审核结果不准确？

- 调整审核策略敏感度
- 使用自定义策略
- 反馈给腾讯云改进

### Q: 可以审核其他平台的图片吗？

可以，但需要修改代码，将图片上传到审核API。目前只审核本插件生成的图片。

## 相关链接

- [腾讯云数据万象](https://cloud.tencent.com/product/ci)
- [访问管理控制台](https://console.cloud.tencent.com/cam/capi)
- [数据万象控制台](https://console.cloud.tencent.com/ci)

## 下一步

- [配置其他选项](/guide/config)
- [了解会员系统](/guide/membership)
- [查看常见问题](/guide/faq)

