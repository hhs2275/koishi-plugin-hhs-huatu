# 常见问题

## 安装和配置

### 如何获取 NovelAI Token？

1. 登录 [NovelAI 官网](https://novelai.net/)
2. 按 `F12` 打开开发者工具
3. 切换到 `Application` 标签
4. 左侧找到 `Local Storage` > `https://novelai.net`
5. 找到 `auth_token` 项，复制其值

### 提示 401 错误？

**原因**：Token 无效或已过期

**解决方法**：
1. 重新获取 Token
2. 检查 Token 是否复制完整
3. 确认 NovelAI 账号有效且有足够余额

### 提示 429 错误？

**原因**：请求过于频繁，触发 API 限流

**解决方法**：
1. 启用队列系统（默认已启用）
2. 配置多个 Token 轮询使用
3. 增加冷却时间
4. 确保 Token 独享使用

---

## 角色提示词功能

### 角色功能不生效？

**检查清单**：

1. ✅ 确认使用的是 v4/v4.5 模型（`nai4`、`nai4c`、`nai4-5`、`nai4-5c`）
2. ✅ 检查语法：分号分隔、位置格式 `A1-E5`
3. ✅ 启用调试日志查看详细信息
4. ✅ 尝试最简单的测试：`nai4 test -K "1girl@B3;1boy@D3"`

### 角色位置不准确？

- 选择相距较远的位置（如 `A1` 和 `E5`）
- 在提示词中添加更明确的位置描述
- 使用负向提示词排除不想要的布局

### 支持几个角色？

- 理论上不限制数量
- **建议 2-3 个**效果最好
- 过多角色可能导致构图混乱

### 分号在哪里？

- **英文分号**：`;`（Shift + 分号键）
- **中文分号**：`；`（中文输入法直接输入）
- 两种都支持，选择你方便的即可

---

## 会员系统

### 如何授予会员？

需要管理员权限（默认权限等级 3 或以上）：

```bash
会员 -u <QQ号> -d <天数>
```

### 会员可以叠加吗？

可以！重复授予会员会自动叠加时间。

### 如何查看会员列表？

```bash
会员 -l           # 第一页（10条）
会员 -l -p 2      # 第二页
会员 -l -s 20     # 每页显示20条
```

### 自动清理功能是什么？

- 每天定时清理过期会员数据
- 可选清理不活跃的非会员数据
- 可在配置中设置清理时间和规则

### 到期提醒如何设置？

1. 启用「会员到期提醒」
2. 设置检查时间（如每天 12:00）
3. 配置提醒阈值（如提前 24 小时）
4. 添加接收提醒的群组 ID

---

## 图片审核

### 如何配置腾讯云审核？

详细步骤请查看 [腾讯云审核配置](/guide/tencent-audit)。

需要获取的信息：
- SecretId
- SecretKey
- Bucket（存储桶）
- Region（地域）
- BizType（策略类型）

### 审核失败怎么办？

可在配置中选择失败处理方式：
- **阻止发送**：不发送审核失败的图片
- **忽略错误**：即使审核失败也发送图片

### 审核会增加多少时间？

- 腾讯云审核：通常 1-2 秒
- API4AI 审核：通常 1-3 秒
- 基本不影响用户体验

---

## 性能和优化

### 如何提高生成速度？

1. **配置多个 Token**：
   - 支持轮询、随机、并行等策略
   - 多个 Token 可提高并发能力

2. **调整队列设置**：
   - 增加最大并发请求数
   - 根据 Token 数量调整

3. **优化参数**：
   - 减少迭代步数（`-t`）
   - 降低分辨率

### 队列满了怎么办？

- 等待当前任务完成
- 管理员可使用 `novelai.reset-queue <用户>` 重置用户队列
- 调整队列相关配置：
  - 增加最大队列数量
  - 增加单用户队列限制

### 如何减少 API 消耗？

1. 启用会员系统，限制非会员使用
2. 设置合理的每日使用限额
3. 增加冷却时间
4. 限制单用户队列数量

---

## 调试和问题排查

### 如何启用调试日志？

在插件配置的「高级设置」中：
1. 找到「调试日志」选项
2. 勾选启用
3. 保存配置

启用后可以看到：
- 角色提示词解析过程
- API 请求详细参数
- 图片审核详细信息

### 插件无响应？

1. 检查 Koishi 控制台是否有错误日志
2. 检查插件是否正常启用
3. 检查网络连接是否正常
4. 尝试重启插件

### 生成的图片不符合预期？

1. **检查提示词**：
   - 是否描述清晰
   - 是否有冲突的描述
   - 尝试调整提示词顺序

2. **调整参数**：
   - 增加迭代步数 (`-t`)
   - 调整 CFG Scale (`-c`)
   - 尝试不同的采样器 (`-s`)

3. **使用负向提示词**：
   - 排除不想要的元素
   - 示例：`-u bad quality, blurry`

---

## 错误代码

| 错误代码 | 说明 | 解决方法 |
|----------|------|----------|
| 401 | Token 无效 | 重新获取 Token |
| 402 | 余额不足 | 充值 NovelAI 账号 |
| 429 | 请求过快 | 启用队列系统，配置多Token |
| 500 | 服务器错误 | 稍后重试，或联系 NovelAI |
| 503 | 服务不可用 | NovelAI 服务维护中 |

---

## 获取帮助

### 指令帮助

```bash
help nai      # 查看基础指令
help 会员     # 查看会员相关指令
```

### 社区支持

- **QQ交流群**：[112879548](https://qm.qq.com/q/4nKKvckKbu)
- **作者QQ**：2275438102

### 反馈问题

在交流群中反馈问题时，请提供：
1. 使用的指令
2. 错误提示（如果有）
3. 相关日志
4. 插件版本

---

## 更多资源

- [快速开始](/guide/getting-started)
- [功能介绍](/guide/features)
- [角色提示词教程](/guide/characters)
- [配置选项](/guide/config)

